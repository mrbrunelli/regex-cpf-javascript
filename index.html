<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replace CPF</title>
</head>

<body>

    <div style="margin: 200px 200px 0 200px;">
        <h1>Formatando CPF com RegEx</h1>
        <label for="cpf">CPF: </label>
        <input type="text" id="cpf" maxlength="14" minlength="14" required>
    </div>

    <div style="margin:0 200px 0 200px;">
        <span>Formatado: <p style="display: inline-block;" id="txt"></p></span>
        <span
            style="display: block;"><code>Desenvolvido por <a href="https://github.com/mrbrunelli" target="_blank">Matheus R. Brunelli</a></code></span>
    </div>

    <script>
        const cpf = document.querySelector('#cpf')
        const txt = document.querySelector('#txt')

        // Quando a tecla subir a função é disparada
        cpf.addEventListener('keyup', () => {
            txt.innerText = formatarCpf(cpf.value)
        })

        // Função para formatar CPF
        function formatarCpf(cpf) {
            // Remove tudo que não é dígito
            cpf = cpf.replace(/\D/g, '')

            /*
                Para formatar em tempo real eu elaborei uma lógica que verifica do maior para o menor.
                Conforme o valor atenda as condições, ele cai no return e atualiza o valor do input.
            */
            if (cpf.length >= 14) return document.querySelector('#cpf').value = cpf.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, '$1.$2.$3-$4')
            if (cpf.length >= 11) return document.querySelector('#cpf').value = cpf.replace(/(\d{3})(\d{3})(\d{3})/, '$1.$2.$3-')
            if (cpf.length >= 7) return document.querySelector('#cpf').value = cpf.replace(/(\d{3})(\d{3})/, '$1.$2.')
            if (cpf.length >= 4) return document.querySelector('#cpf').value = cpf.replace(/(\d{3})/, '$1.')
        }
    </script>

</body>

</html>